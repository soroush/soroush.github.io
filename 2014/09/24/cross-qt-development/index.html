<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fa-ir" lang="fa-ir">
<head>
  <link href="//gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.68.3" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>توسعهٔ میان‌نسخه‌ای &middot; اختاپوس خسته</title>

  
  <link type="text/css" rel="stylesheet" href="https://soroush.github.io/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="https://soroush.github.io/css/poole.css">
  <link type="text/css" rel="stylesheet" href="https://soroush.github.io/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="https://soroush.github.io/css/hyde.css">
  <link type="text/css" rel="stylesheet" href="https://soroush.github.io/css/all.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_SVG">
</script> 
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    "HTML-CSS": {
    styles: {
        ".MathJax .mo, .MathJax .mi": {color: "black ! important"}
    }
    }
});
</script> 




</head>

  <body class=" layout-reverse">
  <aside class="sidebar">
  <div class="container sidebar-sticky-top">
    <div class="sidebar-about">
       <img style="border-radius:50%; background:#fafafa" src="https://soroush.github.io/static/images/octo.svg" alt="Avatar">
    </div>
  </div>
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="https://soroush.github.io/"><h1>اختاپوس خسته</h1></a>
      <p class="lead">
       یادداشت‌هایی دربارهٔ برنامه‌نویسی و زندگی 
      </p>
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li><a href="https://soroush.github.io/">صفحهٔ اول</a> </li>
        <li><a href="https://github.com/soroush/">&#x202d;<i class="fab fa-github"></i> soroush&#x202c;</a></li>
        
      </ul>
    </nav>

    <p>حقوق نشر محفوظ است.</p>
  </div>
</aside>

    <main class="content container">
    <div class="post">
  <h1>توسعهٔ میان‌نسخه‌ای</h1>

  <time datetime=2014-09-24T00:00:00Z class="post-date">چهارشنبه، ۲ مهر ۱۳۹۳</time>
  <p>سال گذشته توی
<a href="http://onealonebit.wordpress.com/2013/09/10/cross-qt-development">وبلاگ انگلیسی‌م</a>
پستی در مورد توسعهٔ نرم‌افزار بین نسخه‌های مختلف کیوت
نوشته بودم که مدت‌هاست وقت نکردم ترجمه‌ش کنم. این پست در مورد توضیح یک روش
کارامد برای کدنویسی بین
نسخهٔ ۴ و ۵ کیوت هست اما میشه کلیت‌ش رو به تمام چارچوب‌ها و کتابخانه‌هایی که در
یک بازهٔ زمانی چند نسخه دارند، تعمیم داد. برای برنامه‌هایی که به‌طور طولانی‌مدت
پشتیبانی میشن، این شرایط خیلی زیاد پیش میاد.فرض کنید برنامه‌ای نوشته میشه که
قراره با ZMQ نسخهٔ ۲ کار کنه. بعد از گذشت چند سال توسعه‌دهنده‌ها به این نتیجه
می‌رسن که باید نسخهٔ ۳ پشتیبانی بشه و پکیج‌هایی از کدهای کامپایل شده با نسخهٔ ۳
تهیه بشه. بنابراین بهترین راه حل نوشتن کدی هست که با هر دو نسخه کامپایل بشه.
برای ابزارهایی که کتابخانه نیستند هم همین صادق هست. مثلاً اسکریپتی که قراره با
پایتون ۲ کار کنه اما باید با پایتون ۳ هم کار کنه.</p>
<p>کیوت نسخهٔ پنج نزدیک یک سال پیش منتشر شد. اولین نسخهٔ رسمی فاجعه‌آمیز بود!
۵٫۰٫۱ کمی بهتر بود، ۵٫۱٫۰ به‌قدر کافی خوب بود و ۵٫۱٫۱ پایدار شده بود. در حال
حاضر نسخهٔ ۵٫۳٫۰ را داریم که با وجود نسخهٔ پچ صفرم، به‌قدر کافی پایدار و
بی‌اشکال شده. برای یک توسعهٔ دهندهٔ کیوت، عادت کردن به نسخهٔ جدید زیاد سخت
نیست. یک راهنمای بسیار عالی هم
<a href="http://qt-project.org/wiki/Transition_from_Qt_4.x_to_Qt5">اینجا</a>
برای کسایی که می‌خوان از کیوت نسخهٔ چهار به پنج مهاجرت کنن نوشته شده.</p>
<p>برای من هم اتفاق مشابهی می‌افته&hellip; دیر یا زود مجبور میشم که تمام پروژه‌هام رو
به کیوت پنج ارتقا بدم. خوب پس منتظر چی هستم؟ یه خبر بد اینه که:
<strong>سازگاری عقبگرد کد</strong>
باید حتماً رعایت بشه! این یک مقدار کارم رو سخت خواهد کرد. چون پروژه‌هام
رو روی ویندوز با استفاده از آخرین نسخه‌های پایدار کیوت می‌سازم و روی لینوکس با
استفاده از نسخه‌های مخازن سیستم‌عامل. اکثر توزیع‌های لینوکس همچنان نسخهٔ ۴ رو
به‌عنوان نسخهٔ اصلی کیوت توی مخازن نگه داشتن. و البته دلیلش هم واضحه: حجم بسیار
بزرگ وابستگی بسته‌های دیگه به کیوت. اما توی ویندوز که کلاً چیزی به اسم پکیجینگ
یا مدیریت وابستگی نداریم، دلیلی هم نداره بچسبیم به یه نسخهٔ پایدار. (به شکلی
بسیار ناکارآمد و احمقانه، همیشه تمام پیش‌نیازهای یک برنامه رو بغل‌دستش منتشر
می‌کنیم، و این تقصیر توسعه‌دهنده‌ها نیست. ویندوز مدلش این‌شکلی‌یه!)</p>
<p>خوب پس بهترین راه حل برام تبدیل کد به یک حالت میانی هست که هم با کیوت ۴ کامپایل
و اجرا بشه و هم با کیوت ۵. کسل‌کننده به‌نظر میرسه&hellip; خوب واقعاً هم کسل‌کننده‌ست.</p>
<p>راهکار مشابه
[پست قبلی دربارهٔ توسعهٔ چندسکویی]
()
رو ادامه میدم. پس قانون اول میشه:</p>
<blockquote>
<p>اگر روشی مثل (W) برای انجام وظیفه‌ای مثل (T) وجود داشته باشد، به‌طوری که هم با نسخهٔ ۴ و هم با نسخهٔ ۵ سازگار باشد، در این صورت از آن استفاده کنید؛ مگر این که پیچیدگی آن روش، بیشتر از مجموع پیچیدگی پیاده‌سازی روش ویژهٔ نسخهٔ چهارم و روش ویژهٔ نسخهٔ پنجم باشد.</p>
</blockquote>
<p>به بیان ریاضی:
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">if</span><span class="p">(</span> <span class="n">W</span> <span class="o">&lt;</span> <span class="n">W4</span><span class="o">+</span> <span class="n">W5</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">T</span><span class="p">.</span><span class="k">do</span><span class="p">(</span><span class="n">W</span><span class="p">);</span>
<span class="p">}</span> 
<span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">W</span> <span class="o">&gt;</span> <span class="n">W4</span> <span class="o">+</span> <span class="n">W5</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">Qt5</span><span class="p">)</span>
         <span class="n">T</span><span class="p">.</span><span class="k">do</span><span class="p">(</span><span class="n">W5</span><span class="p">);</span>
     <span class="k">else</span>
         <span class="n">T</span><span class="p">.</span><span class="k">do</span><span class="p">(</span><span class="n">W4</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></p>
<p>و قانون دوم هم نتیجهٔ بدیهی قانون اول خواهد بود:</p>
<blockquote>
<p>اگر روش مشترکی برای اجرای کیوت پنج و چهار وجود ندارد، هر دو روش را پیاده‌سازی کرده و زمان کامپایل تصمیم بگیرید که کدام پیاده‌سازی کامپایل شود.</p>
</blockquote>
<p>اجازه بدید یک مثال از پروژهٔ Qtz بزنم. داخل فایل‌های پروژه من باید مراقب
تغییرات
در سیستم ماژول‌ها باشم. خوشبختانه ماکروهایی برای تشخیص نسخهٔ کیوت وجود دارند.
حتا بهتر از آن متغیرهای شرطی برای اندازه‌گیری عدد نسخه.</p>
<pre><code class="language-qmake" data-lang="qmake">QT += core gui sql
greaterThan(QT_MAJOR_VERSION, 4): QT += widgets
greaterThan(QT_MAJOR_VERSION, 4): CONFIG   += C++11
lessThan(QT_MAJOR_VERSION, 5): QMAKE_CXXFLAGS += -std=c++11</code></pre>
<p>و همین قاعده روی کدها هم تأثیر می‌ذاره:
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">CandleGraphicsItem</span><span class="o">::</span><span class="n">CandleGraphicsItem</span><span class="p">(</span><span class="k">const</span> <span class="n">Candle</span><span class="o">&amp;</span> <span class="n">candle</span><span class="p">,</span> <span class="n">QGraphicsItem</span> 
<span class="o">*</span><span class="n">parent</span><span class="p">)</span> 
    <span class="o">:</span><span class="n">QGraphicsItem</span><span class="p">(</span><span class="n">parent</span><span class="p">),</span> <span class="n">candle_</span><span class="p">(</span><span class="n">candle</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#if QT_VERSION &gt;= 0x050000
</span><span class="cp"></span>    <span class="n">setAcceptHoverEvents</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
<span class="cp">#else
</span><span class="cp"></span>    <span class="n">setAcceptsHoverEvents</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
<span class="cp">#endif
</span><span class="cp"></span>    <span class="k">this</span><span class="o">-&gt;</span><span class="n">setY</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">candle</span><span class="p">.</span><span class="n">low_</span><span class="o">+</span><span class="n">candle</span><span class="p">.</span><span class="n">high_</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></p>
<p>با استفاده از ماکروی
<a href="http://qt-project.org/doc/qt-5/qtglobal.html#QT_VERSION">QT_VERSION</a>
از هدر <!-- raw HTML omitted --> می‌تونید به‌راحتی نسخهٔ کیوت رو تشخیص بدید که این خیلی خوبه
(:
حالا من می‌تونم نرم‌افزارم رو روی کیوت‌های ۴٫۶ تا ۵٫۳ کامپایل کنم.</p>
<p>برای جزئیات بیشتر <a href="http://www.kdab.com/porting-from-qt-4-to-qt-5/">این مقاله</a>
از
بچه‌های KDAB رو بخونید. اون‌ها همچنین یک
<a href="http://www.kdab.com/automated-porting-from-qt-4-to-qt-5/">اسکریپت</a> برای تبدیل
اتوماتیک کدها از کیوت ۴ به کیوت ۵ نوشتن.</p>
</div>

<h2>دیدگاه‌ها</h2>
<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "khtpws-khsth" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </main>

    
  </body>
</html>
