<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[طبقه‌بندی‌هاتاریخ_جلالی | اختاپوس خسته]]></title>
  <link href="http://soroush.github.io/categories/trykh-jlly/atom.xml" rel="self"/>
  <link href="http://soroush.github.io/"/>
  <updated>2017-05-15T03:16:26+04:30</updated>
  <id>http://soroush.github.io/</id>
  <author>
    <name><![CDATA[سروش]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[فارسی کردن بلاگ]]></title>
    <link href="http://soroush.github.io/blog/persian/"/>
    <updated>2013-09-17T00:00:00+04:30</updated>
    <id>http://soroush.github.io/blog/persian</id>
    <content type="html"><![CDATA[<p>قبلاً گفتم که سیستم مورد استفاده در این وبلاگ اوکتوپرس هست. متأسفانه تاریخ‌ها و تمام جزئیات مربوطه روی سیستم Georgian بود و به شکل انگلیسی نمایش داده میشد. امروز این مشکل رو حل کردم {کف مرتب} این‌جا می‌نویسم شاید به درد کسی بخوره.</p>

<!-- more -->


<p>اول از همه باید ببینیم که تاریخ‌ها چطور و توسط چه کسی ساخته میشن. تاریخ‌ها رو خود برنامهٔ اوکتوپرس از روی پست مارک‌داون تولید می‌کنه. بعدش تگ‌های HTML به این صورت داخل صفحه درج میشه:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;time</span> <span class="na">datetime=</span><span class="s">&quot;2013-09-16T13:39:00+04:30&quot;</span> <span class="na">pubdate</span> <span class="na">data-updated=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>Sep 16<span class="nt">&lt;span&gt;</span>th<span class="nt">&lt;/span&gt;</span>, 2013
</span><span class='line'><span class="nt">&lt;/time&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>الان باید ببینیم که دقیقاً کدوم اسکریپت هست که این فایل رو تولید می‌کنه. بعد از یکمی گشت و گذار می‌بینیم که اسکریپت date.rb داخل پوشهٔ plugins مسئول تولید کد برای تاریخ‌ها هستش. الآن می‌دونیم باید چی‌کار کنیم. هدف اینه که اون کدها طوری تغییر داده بشن که تاریخ‌ها به صورت جلالی نشون داده بشه. برای این کار دو تا چیز لازم داریم. یکی پیاده‌سازی تاریخ جلالی در زبان روبی و دیگری روشی برای این که تگ‌های
&lt;time>
پروتکل HTML رو مجبور کنیم که تاریخ جلالی رو قبول کنن. متأسفانه برای دومی کنسرسیوم بین‌المللی وب هنوز راه‌کاری ارائه نداده ولی خوشبختانه پیاده‌سازی تقویم جلالی در روبی موجود هست. دوستان عزیزمون
<a href="https://github.com/aziz">آلن برگی</a>
پیاده‌سازی بسیار خوبی رو
<a href="https://github.com/aziz/jalalidate">این‌جا</a>
منتشر کردن. این پیاده‌سازی در مخازن gem هم موجوده. خوب شروع می‌کنیم:
<div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>~<span class="nv">$ </span>sudo gem install jalalidate
</span><span class='line'><span class="o">[</span>sudo<span class="o">]</span> password <span class="k">for </span>soroush:
</span><span class='line'>Fetching: jalalidate-0.3.3.gem <span class="o">(</span>100%<span class="o">)</span>
</span><span class='line'>Successfully installed jalalidate-0.3.3
</span><span class='line'>1 gem installed
</span><span class='line'>Installing ri documentation <span class="k">for </span>jalalidate-0.3.3&amp;hellip;
</span><span class='line'>Installing RDoc documentation <span class="k">for </span>jalalidate-0.3.3&amp;hellip;
</span></code></pre></td></tr></table></div></figure></notextile></div>
بعدش بررسی می‌کنیم که آیا گِم مورد نظر به‌درستی نصب شده یا نه؟ اگه همه‌چی خوب پیش رفته باشه باید:
<div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>~<span class="nv">$ </span>gem list jalalidate
</span><span class='line'>&lt;strong&gt;&lt;em&gt; LOCAL GEMS &lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;jalalidate <span class="o">(</span>0.3.2<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
اگه خیلی پارانویا باشید (مثل من) می‌تونید:
<div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>ruby -rubygems -e &amp;lsquo;require &amp;ldquo;jalalidate&amp;rdquo;&amp;rsquo; <span class="c"># خروجی باید خالی باشه. یعنی بدون ارور</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
قبل از این‌که بریم سراغ اسکریپت date، باید به jalalidate رو به rake معرفی کنیم. در مورد این کار مشکلات خیلی زیادی داشتم! چون خود اکتوپرس یک گِم هست، تنها اضافه کردن require &lsquo;jalalidate&rsquo; به اول Rakefile کفایت نمی‌کنه. خوب من اینو نمی‌دونستم! باید به Gemfile هم چیزهایی رو اضافه کنیم:
<div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">source</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;https://rubygems.org&quot;</span><span class="o">&gt;</span><span class="ss">https</span><span class="p">:</span><span class="sr">//</span><span class="n">rubygems</span><span class="o">.</span><span class="n">org</span><span class="o">&lt;</span><span class="sr">/a&gt;&amp;rdquo;</span>
</span><span class='line'><span class="sr">group :development do</span>
</span><span class='line'><span class="sr">  gem &amp;lsquo;rake&amp;rsquo;, &amp;lsquo;~&gt; 0.9&amp;rsquo;</span>
</span><span class='line'><span class="sr">  # &amp;hellip;.</span>
</span><span class='line'><span class="sr">  gem &amp;lsquo;jalalidate&amp;rsquo; ,&amp;lsquo;~&gt; 0.3.3&amp;rsquo;</span>
</span><span class='line'><span class="sr">end</span>
</span><span class='line'><span class="sr">gem &amp;lsquo;sinatra&amp;rsquo;, &amp;lsquo;~&gt; 1.4.2&amp;rsquo;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
مرحلهٔ بعد اضافه کردن jalalidate به Rakefile مون هست. فقط کافیه که یه بعد از آخرین require اضافه کنیم:
<div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">jalalidate</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
الان برای تبدیل فرمت نام‌گذاری مارک‌داون‌ها، خطوط زیر رو تغییر می‌دیم. برای این که زیاد شلوغ‌بازی نشه متن اصلی رو نمی‌نویسم. دقیقاً
<a href="https://github.com/imathis/octopress/blob/master/Rakefile#L102">این خط</a> هست.
<div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">filename</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="c1">#{source_dir}/#{posts_dir}/#{JalaliDate.new(Date.today)&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span>             <span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-%d&#39;</span><span class="p">)}</span><span class="o">-</span><span class="c1">#{title.to_url}.#{new_post_ext}&quot;</span>
</span><span class='line'><span class="o">&lt;</span><span class="sr">/code&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
دقت کنید که به بقیهٔ تاریخ‌ها دست نمی‌زنیم! چون بک‌اند اصلی ما تاریخ گریگورین هست. و HTML نمی‌تونه تاریخ دیگه‌ای رو بفهمه. علاوه‌بر این ما در ادامه می‌خوایم اسکریپت تولید تاریخ رو طوری تغیید بدیم که تاریخ پست رو به جلالی تبدیل کنه و بعد داخل کد تولید شده درج کنه. برای این کار همون فایل date.rb رو باز می‌کنیم و این‌جا رو تغییر میدیم:
<div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;h1&gt;Returns an ordidinal date eg July 22 2007 &amp;ndash;&gt; July 22nd 2007&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">now</span> <span class="n">returns</span> <span class="mi">26</span> <span class="err">شهریور</span> <span class="mi">1392</span><span class="o">&lt;</span><span class="sr">/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;def ordinalize(date)&lt;/</span><span class="nb">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
</span><span class='line'><span class="n">jd</span> <span class="o">=</span>    <span class="no">JalaliDate</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
</span><span class='line'><span class="s2">&quot;</span><span class="si">#{</span><span class="n">jd</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%e&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">jd</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%b&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">jd</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'><span class="o">&lt;</span><span class="sr">/code&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;</span><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
هر فرمت دیگه‌ای هم که بخواید می‌تونید انتخاب کنید. مثلا «سه‌شنبه 26 شهریور 1392». مشکل اصلی که همچنان وجود داره رقم‌ها هستند. من ترجیه میدم که با ارقام فارسی نوشته بشه. مثلاً «سه‌شنبه ۲۶ شهریور ۱۳۹۲». برای حل این مشکل خیلی راحت میشه یه تابع روبی نوشت که ارقام رو جایگزین کنه. خوب اونم نگه می‌دارم واسه بعد :دی چون هنوز روبی رو خوب بلد نیستم. در واقع اصلاً بلد نیستم. این اولین برخوردم بوده.</p>

<p>می‌مونه لینک‌هایی که سیستم تولید می‌کنه. اون‌ها هم کاری ندارن. عین همین کاری که بالا انجام دادم فقط باید پیدا کنید که کی مسئول تولید کدش هست و خفت‌شو بگیرید.</p>
]]></content>
  </entry>
  
</feed>
